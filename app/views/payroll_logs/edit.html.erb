<%- model_class = PayrollLog -%>
<div class="page-header">
  <h1><%=t '.title', :default => t('helpers.titles.edit', :model => model_class.model_name.human,
                                   :default => "Edit #{model_class.model_name.human}") %></h1>
  <h3>
	<%= @payroll_log.payroll.payroll_type.description %> del 
	<%= @payroll_log.payroll.start_date %> al 
	<%= @payroll_log.payroll.end_date %>
  	<div style="float:right" id="payroll_total" ><%= @payroll_log.payroll_total %></div>
  	<div style="float:right">Acumulado = &nbsp;</div>
  </h3>
  <div style="clear:both;">
  </div>
</div>
<%= render :partial => 'form' %>
 <div class="accordion" id="accordion">
	<% @count = 0 %>
	<% @total = 0 %>
	<% @result.each do |e| %>
	<div class="accordion-group">
		<div class="accordion-heading">
 			<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse<%= @count %>">
 				<%= e[0][1] %>
 			</a>
 		</div>
		<div id="collapse<%= @count %>" class="accordion-body collapse">
 			<div class="accordion-inner">
				<table class="table table-hover table-bordered table-striped" id="employee_table_<%= e[0][0] %>">
					<thead>
						<td>Fecha</td>
						<td>Labor</td>
						<td>Cantidad</td>
						<td>Centro de Costos</td>
						<td>Tipo de Pago</td>
						<td>Total</td>
						<td>Accion</td>
					</thead>
					<tbody>
					<% e[1].each do |h| %>
						<tr id="tr_<%= e[0][0] %>_<%= h.id %>">
							<td><%= h.payroll_date %></td>
							<td><%= h.task.ntask %></td>
							<td><%= h.time_worked %></td>
							<td><%= h.centro_de_costo.nombre_cc %></td>
							<td><%= h.payment_type %></td>
							<td><%= h.total.to_f %></td>
							<% @total += h.total.to_f %>
							<td>
								<button type="button" class="btn btn-mini btn-danger">remove</button>
								<input type="hidden" value="<%= e[0][0] %>">
								<input type="hidden" value="<%= h.id %>">
							</td>
						</tr>
						<% end %>
						<tr id="total_<%= e[0][0] %>">
							<td colspan="5" class="align_right">Total:</td>
							<td colspan="2"><%= @total %></td>
						</tr>
					</tbody>
				</table>
 			</div>
 		</div>
	</div>
	<% @total = 0 %>
	<% @count += 1 %>
	<% end %>
</div>

<%= javascript_tag  do %>

	/************************ 
		Type payment 
	************************/
	var type_payment = []
	
	<% CONSTANTS[:PAYMENT].each do |payment| %>
	    type_payment.push({
		    "name": "<%= payment["name"] %>",
			"value": "<%= payment["type"] %>"
		});
	<% end %>
	
	/************************ 
	Employees Information 
	************************/
	<% id = ''  %>
	<% date = ''  %>
	<% task = ''  %>
	<% cost = ''  %>
	<% type_payment = ''  %>
	
	var employees_info = []
	var data = []

	<% @result.each do |e| %>
		
		<% id = e[0][0]  %>
		<% name = e[0][1]  %>
		
		<% e[1].each do |h| %>
			<% date = "#{@payroll_log.payroll_date}" %>
			<% task = "#{h.task.ntask}" %>
			<% cost = "#{h.centro_de_costo.nombre_cc}" %>
			<% type_payment = "#{h.payment_type}" %>

			data.push({
			    "date": "<%= date %>",
			    "task": "<%= task %>",
			    "cost": "<%= cost %>",
			    "type_payment": "<%= type_payment %>"
			});
		<% end %>

		employees_info.push({
			    "id":"<%= id %>",
			    "name":"<%= name %>",
			    "data": data
			}); 
		data = []
	<% end %>

<% end %>